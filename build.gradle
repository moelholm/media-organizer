buildscript {
    ext {
        springBootVersion = '1.5.1.RELEASE'
        commonsLangVersion = '2.4'
    }
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath "org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}"
    }
}

apply plugin: 'java'
apply plugin: 'org.springframework.boot'

group 'com.moelholm'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {

    compile "org.springframework.boot:spring-boot-starter-actuator"
    compile "org.springframework.boot:spring-boot-starter-web"
    compile "com.fasterxml.jackson.core:jackson-databind"
    compile "commons-lang:commons-lang:${commonsLangVersion}"

    testCompile "org.springframework.boot:spring-boot-starter-test"

}

bootRun {
    systemProperties = System.properties
}

task triggerJob << {
    print ""
    print "----"
    print "from env: " + System.getenv().hasProperty('web.apiKey')
    print "from env: " + System.getenv('web.apiKey')
    print "----"

    if (System.properties['web.apiKey']) {
        print "Running media organizer"
        "https://media-organizer.herokuapp.com/api/mediaorganizer/trigger"
                .toURL()
                .getText(requestProperties: [Authorization: System.properties['web.apiKey']])
    } else {
        logger.error "Did not find apiKey in System properties!"
    }
}